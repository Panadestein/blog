<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Climbing Mount Euler</title>
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="../assets/style.css"/>
<link rel="icon" href="../assets/favicon.ico" type="image/x-icon">
<style>
mjx-container[jax="CHTML"] {
overflow-x: auto !important;
}
</style>
<!-- Post-specific setting bellow -->
<style>
#table-of-contents > h2 { display: none; }
#text-table-of-contents > ul {
display: grid;
grid-template-columns: repeat(8, 1fr);
gap: 10px;
list-style: none;
padding: 0;
margin: 0;
}
#table-of-contents > ul > li {
text-align: center;
}
</style>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Climbing Mount Euler</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org679c663">1</a></li>
<li><a href="#orgc5c275b">2</a></li>
<li><a href="#org635c32b">3</a></li>
<li><a href="#org1d0d072">4</a></li>
<li><a href="#org0cfb1ce">5</a></li>
<li><a href="#org0612a6b">6</a></li>
<li><a href="#org1aba18d">7</a></li>
<li><a href="#org6b1166b">8</a></li>
<li><a href="#orgc015703">9</a></li>
<li><a href="#org9259446">10</a></li>
<li><a href="#org3d056b7">11</a></li>
<li><a href="#orga8e6dc0">12</a></li>
<li><a href="#pe13">13</a></li>
<li><a href="#org0515746">14</a></li>
<li><a href="#org7deccd7">15</a></li>
<li><a href="#pe16">16</a></li>
<li><a href="#org0ffacf0">17</a></li>
<li><a href="#org65aebf7">18</a></li>
<li><a href="#orgae05ab7">19</a></li>
<li><a href="#orge4e8208">20</a></li>
<li><a href="#org30d3cd9">21</a></li>
</ul>
</div>
</div>
<div id="outline-container-orga62fdcb" class="outline-2">
<h2 id="orga62fdcb">Foreword</h2>
<div class="outline-text-2" id="text-orga62fdcb">
<p>
This post presents my BQN solutions to some of the problems in <a href="https://projecteuler.net/">Project Euler</a>.
It is discouraged to share them, but I very much dislike writing throw-away code,
and that's why they are here<sup><a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup>. First I will solve problems in order, and then I will
probably pick the ones that I find interesting. This is my profile, if you want to
see my progress:
</p>

<a href="https://projecteuler.net/profile/panadestein.png" target="_blank">
  <img src="https://projecteuler.net/profile/panadestein.png" alt="My Project Euler Profile" style="border: 0;">
</a>

<p>
Let's start by defining some utilities that will be shared by several problems:
</p>

<div class="org-src-container">
<pre class="src src-bqn">utils ← {
  Sieve ⇐ 2⊸↓{
    L ← 𝔽{0¨⌾((𝕨×𝔽/(⌈𝕨÷˜≠)⊸↑𝕩)⊸⊏)𝕩}
    M ← ⊢&gt;×˜∘⊣⊸⥊⟜0»≠∘⊢⥊↑⟜1
    𝔽/(𝕩⥊1)≤⟜20◶L‿M⍟⊑´⌽𝔽↕⌈√𝕩
  }
  Rosser ⇐ ⌈⋆⁼{𝔽∘𝔽⊸+⟜𝔽⊸×}
  Tau ⇐ {2+´(2⊸×-⊢×⊣=÷˜⟜𝕩)⟜(0=|⟜𝕩)2↓↕1+⌊√𝕩}
  Sigma ⇐ {+´1∾𝕩⊸÷⊸∾(0=|⟜𝕩)⊸/2↓↕1+⌊√𝕩}
}
parsing ← {
  Split ⇐ (¬-˜⊢×·+`»⊸&gt;)∘≠⊔⊢
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org679c663" class="outline-2">
<h2 id="org679c663">Problem 1</h2>
<div class="outline-text-2" id="text-org679c663">
<div class="org-src-container">
<pre class="src src-bqn">E1 ← +´(∨´0=5‿3|&lt;)⊸/
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc5c275b" class="outline-2">
<h2 id="orgc5c275b">Problem 2</h2>
<div class="outline-text-2" id="text-orgc5c275b">
<p>
Estimate the upper bound with Binet's formula.
</p>

<div class="org-src-container">
<pre class="src src-bqn">E2 ← {+´(¬2⊸|)⊸/{⊑¨+`∘⌽⍟(↕𝕩)↕2}(⌈0.5+𝕩⊸×÷○(⋆⁼)2÷˜1⊸+)√5}
</pre>
</div>
</div>
</div>
<div id="outline-container-org635c32b" class="outline-2">
<h2 id="org635c32b">Problem 3</h2>
<div class="outline-text-2" id="text-org635c32b">
<p>
A brute force attempt, in which I got lucky. We create a primes table, and then check:
</p>

<div class="org-src-container">
<pre class="src src-bqn">p ← ¬∘∊⟜(⥊×⌜˜)⊸/2↓↕1e4
{𝕩=×´f←p/˜0=p|&lt;𝕩 ? ⌈´f; @}600851475143
</pre>
</div>

<p>
Provided the size of the input, a much reasonable approach is trial division. We can
achieve this with the following tacit function:
</p>

<div class="org-src-container">
<pre class="src src-bqn">E3 ← ⊢´(0=|)◶⟨+⟜2⊸⋈, ⊣⋈÷˜⟩´•_while_(×˜⊸&lt;´)
</pre>
</div>

<p>
Explanation: since the number is odd, we can start with 3. While the current
divisor is less than the square root of the current number, we check if it
divides the number. If it does, we divide the number by the divisor.
If it doesn't, we increment the divisor by 2 (to consider only odd factors).
This works because a composite number must have a prime factor less
than or equal to its square root.
</p>
</div>
</div>
<div id="outline-container-org1d0d072" class="outline-2">
<h2 id="org1d0d072">Problem 4</h2>
<div class="outline-text-2" id="text-org1d0d072">
<p>
Anything other than brute force here? A little tacit function:
</p>

<div class="org-src-container">
<pre class="src src-bqn">E4 ← ⌈´·(⌽⊸≡•Fmt)¨⊸/·⥊×⌜˜
</pre>
</div>

<p>
This runs in 5 ms with the optimization of searching only in the 900's.
</p>
</div>
</div>
<div id="outline-container-org0cfb1ce" class="outline-2">
<h2 id="org0cfb1ce">Problem 5</h2>
<div class="outline-text-2" id="text-org0cfb1ce">
<p>
That felt almost trivial.
</p>

<div class="org-src-container">
<pre class="src src-bqn">E5 ← •math.LCM´
</pre>
</div>
</div>
</div>
<div id="outline-container-org0612a6b" class="outline-2">
<h2 id="org0612a6b">Problem 6</h2>
<div class="outline-text-2" id="text-org0612a6b">
<p>
Yeah well, what can I say, I love this identity:
</p>

<div class="org-src-container">
<pre class="src src-bqn">E6 ← ×˜⊸(+´×-⊣)
</pre>
</div>

<p>
In fact, I was terribly stupid. There are closed form solutions for the sum
of the first \(n\) integers and its squares (remember induction?). So after
squaring the former, subtracting the latter and simplifying we get this constant
time solution:
</p>

<div class="org-src-container">
<pre class="src src-bqn">12÷˜×´⟨⊢, -⟜1, +⟜1, 2+3⊸×⟩{𝕎𝕩}¨100
</pre>
</div>

<p>
Quite a few characters more, though.
</p>
</div>
</div>
<div id="outline-container-org1aba18d" class="outline-2">
<h2 id="org1aba18d">Problem 7</h2>
<div class="outline-text-2" id="text-org1aba18d">
<p>
The idea here is to use Eratosthenes' sieve with a correct upper bound, which we get
thanks to Rosser's <a href="https://en.wikipedia.org/wiki/Prime-counting_function#Inequalities">theorem</a>:
</p>

<div class="org-src-container">
<pre class="src src-bqn">E7 ← -⟜1⊑utils{𝕗.Sieve𝕗.Rosser}
</pre>
</div>
</div>
</div>
<div id="outline-container-org6b1166b" class="outline-2">
<h2 id="org6b1166b">Problem 8</h2>
<div class="outline-text-2" id="text-org6b1166b">
<p>
A simple windowed reduction:
</p>

<div class="org-src-container">
<pre class="src src-bqn">E8 ← ⌈´·(×´⊢-@+48˙)˘13⊸↕
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc015703" class="outline-2">
<h2 id="orgc015703">Problem 9</h2>
<div class="outline-text-2" id="text-orgc015703">
<p>
A stupid brute force does the trick:
</p>

<div class="org-src-container">
<pre class="src src-bqn">{⊑(××+⌾(×˜))´¨1+/○⥊⟜(↕≢)(&lt;⌜˜↕≠𝕩)×(1e3=+++⌾(×˜))⌜˜𝕩} 1+↕1e3
</pre>
</div>

<p>
But I hate it and it is painfully slow. The correct way of doing it is using <a href="https://en.wikipedia.org/wiki/Pythagorean_triple#Proof_of_Euclid's_formula">Euclid's formula</a>.
</p>

<div class="org-src-container">
<pre class="src src-bqn">E9 ← {⋆⟜4{2×××𝔽˜-𝔽}´¨1+/○⥊⟜(↕≢)⌊⊸=𝕩÷˜(⊢×+)⌜○(1+↕)˜⌈√𝕩}
</pre>
</div>

<p>
Here we have used the fact that the sum of the triplet expressed with Euclid's formula
must be \(km(m+n)=500\), with \(m>n>1\) coprime and one of them odd. It suffices to loop
until √500 because \(m\) cannot be larger than it, as \(n\) is positive.
</p>
</div>
</div>
<div id="outline-container-org9259446" class="outline-2">
<h2 id="org9259446">Problem 10</h2>
<div class="outline-text-2" id="text-org9259446">
<p>
The sieve again:
</p>

<div class="org-src-container">
<pre class="src src-bqn">E10 ← +´utils.Sieve
</pre>
</div>
</div>
</div>
<div id="outline-container-org3d056b7" class="outline-2">
<h2 id="org3d056b7">Problem 11</h2>
<div class="outline-text-2" id="text-org3d056b7">
<p>
This has to be brute force. First, I will parse the grid:
</p>

<div class="org-src-container">
<pre class="src src-bqn">inp11 ← ∘‿20⥊•ParseFloat¨' 'parsing.Split"08 02 22 97 38 15 00 40 00 75 04 05 07 78 52 12 50 77 91 08 49 49 99 40 17 81 18 57 60 87 17 40 98 43 69 48 04 56 62 00 81 49 31 73 55 79 14 29 93 71 40 67 53 88 30 03 49 13 36 65 52 70 95 23 04 60 11 42 69 24 68 56 01 32 56 71 37 02 36 91 22 31 16 71 51 67 63 89 41 92 36 54 22 40 40 28 66 33 13 80 24 47 32 60 99 03 45 02 44 75 33 53 78 36 84 20 35 17 12 50 32 98 81 28 64 23 67 10 26 38 40 67 59 54 70 66 18 38 64 70 67 26 20 68 02 62 12 20 95 63 94 39 63 08 40 91 66 49 94 21 24 55 58 05 66 73 99 26 97 17 78 78 96 83 14 88 34 89 63 72 21 36 23 09 75 00 76 44 20 45 35 14 00 61 33 97 34 31 33 95 78 17 53 28 22 75 31 67 15 94 03 80 04 62 16 14 09 53 56 92 16 39 05 42 96 35 31 47 55 58 88 24 00 17 54 24 36 29 85 57 86 56 00 48 35 71 89 07 05 44 44 37 44 60 21 58 51 54 17 58 19 80 81 68 05 94 47 69 28 73 92 13 86 52 17 77 04 89 55 40 04 52 08 83 97 35 99 16 07 97 57 32 16 26 26 79 33 27 98 66 88 36 68 87 57 62 20 72 03 46 33 67 46 55 12 32 63 93 53 69 04 42 16 73 38 25 39 11 24 94 72 18 08 46 29 32 40 62 76 36 20 69 36 41 72 30 23 88 34 62 99 69 82 67 59 85 74 04 36 16 20 73 35 29 78 31 90 01 74 31 49 71 48 86 81 16 23 57 05 54 01 70 54 71 83 51 54 69 16 92 33 48 61 43 52 01 89 19 67 48"
</pre>
</div>

<p>
Then we have this hideous thing:
</p>

<div class="org-src-container">
<pre class="src src-bqn">E11 ← {⌈´∾(×˝˘4⊸↕)¨(4≤≠)¨⊸/((⌽++´∘≢)⊸∾·+⌜´↕¨∘≢)⊸⊔⟜(∾˜)𝕩}⌈(⌈´∘⥊·×˝˘4⊸↕){𝔽⌈𝔽∘⍉}
</pre>
</div>

<p>
It computes the answer in 300μs.
</p>
</div>
</div>
<div id="outline-container-orga8e6dc0" class="outline-2">
<h2 id="orga8e6dc0">Problem 12</h2>
<div class="outline-text-2" id="text-orga8e6dc0">
<p>
Here I tried to use an awesome array solution for the number of divisors <code>1+´0=↕⊸|</code>,
which unfortunately does not scale. So I use trial division for computing the divisor
function, and also exploit the fact that since \(\text{GCD}(n, n+1)=1\), the divisor
function is the product of the divisor functions of the two numbers, dividing by 2 the
one that is even:
</p>

<div class="org-src-container">
<pre class="src src-bqn">E12 ← (2÷˜-⟜1⊸×)·⊢´{𝕊:
  (𝕩+1)⋈˜×´utils.Tau¨(2⊸|)◶⟨÷⟜2⋈1⊸+, ⊢⋈2÷˜1⊸+⟩𝕩
}´•_while_(500≥⊑)
</pre>
</div>
</div>
</div>
<div id="outline-container-pe13" class="outline-2">
<h2 id="pe13">Problem 13</h2>
<div class="outline-text-2" id="text-pe13">
<p>
Shall we play lottery with floating point addition? Put the input in a file and have fun:
</p>

<div class="org-src-container">
<pre class="src src-bqn">10↑·'.'⊸≠⊸/∘•Fmt·+´•ParseFloat¨∘•FLines 
</pre>
</div>

<p>
There, a tacit function for the sake of it, that works only by accident. We can always
implement the high school sum algorithm though (check it out with Python or whatever):
</p>

<div class="org-src-container">
<pre class="src src-bqn">E13 ← {∾•Fmt¨{c∾˜𝕩10{𝕩-𝕗×c↩⌊𝕗÷˜𝕩+↩c}¨˜c←0}⌾⌽+˝•ParseFloat∘⋈⚇0&gt;•FLines𝕩}
</pre>
</div>
</div>
</div>
<div id="outline-container-org0515746" class="outline-2">
<h2 id="org0515746">Problem 14</h2>
<div class="outline-text-2" id="text-org0515746">
<p>
Memoization, so we don't wait an eternity:
</p>

<div class="org-src-container">
<pre class="src src-bqn">E14 ← {
  c ← •HashMap˜⋈1
  ⊑⍒2⊸|◶⟨÷⟜2, 1+3⊸×⟩{
    c.Has𝕩 ? c.Get𝕩;
    𝕩(⊢⊣c.Set)1+𝕊𝔽𝕩
  }¨1+↕𝕩
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org7deccd7" class="outline-2">
<h2 id="org7deccd7">Problem 15</h2>
<div class="outline-text-2" id="text-org7deccd7">
<p>
First generate the input array:
</p>

<div class="org-src-container">
<pre class="src src-bqn">inp15 ← 1⌾⊑21‿21⥊0
</pre>
</div>

<p>
Then we can propagate all routes and get the final count:
</p>

<div class="org-src-container">
<pre class="src src-bqn">E15 ← ⊢´∘⥊(»+»˘)⍟(2-˜+´∘≢)
</pre>
</div>

<p>
The repetition count is the number of diagonals minus one, your answer. This is
unfortunately a slow \(O(mn)\) algorithm, for the optimal solution do this:
</p>

<div class="org-src-container">
<pre class="src src-bqn">2⊸×⊸•math.Comb
</pre>
</div>
</div>
</div>
<div id="outline-container-pe16" class="outline-2">
<h2 id="pe16">Problem 16</h2>
<div class="outline-text-2" id="text-pe16">
<p>
For this problem one is better off using a language with native support for
big integers, which makes it trivial. No fancy math either. BQN has integers up to <code>2⋆53</code>,
so we need to roll our own algorithm. Let's first generate an array that will
contain the digits of the result, using an estimation for the length:
</p>

<div class="org-src-container">
<pre class="src src-bqn">inp16 ← 1∾0⥊˜⌊10⋆⁼2⋆1000
</pre>
</div>

<p>
Then we have the following tacit function, which I will dare say is beautiful:
</p>

<div class="org-src-container">
<pre class="src src-bqn">E16 ← +´10{𝕗⊸(|+⟜»·⌊÷˜)⍟(⌈𝕗⋆⁼2×𝕗-1)}∘(2⊸×)⍟1000
</pre>
</div>

<p>
This implementation of arbitrary precision arithmetic is way more elegant
than the one I used in the related <a href="#pe13">Problem 13</a>, although it performs more
(but vectorized) operations. In fact, when I first implemented this code,
I had used this construct with an unbounded while for an arithmetic operation 𝔽:
</p>

<div class="org-src-container">
<pre class="src src-bqn">base⊸(|+⟜»·⌊÷˜)•_while_(∨´≥⟜base)∘𝔽
</pre>
</div>

<p>
Then dzaima pointed out that the while loop could be replaced with a simpler repeat.
Provided we know an upper bound <code>m</code> for the elements involved in the arithmetic operation,
the iteration should not exceed <code>⌈base⋆⁼m×base-1</code>. In general:
</p>

<div class="org-src-container">
<pre class="src src-bqn">MP ← {b𝕊n:
  _o ← {b⊸(|+⟜»·⌊÷˜)⍟(⌈b⋆⁼𝕨×b-1)𝕨𝔽𝕩}
  ⟨+⌾⊑, ×⟩{∾•Fmt¨⌽𝕩𝕎_o´n}¨b⊸⋆⁼{(𝔾∘𝔽⌈´⊸×⟜≠)⋈1∾·𝔾·+´𝔽}(0⥊˜1+⌊)n
}
</pre>
</div>

<p>
Yeah, something like that. Although the sum is less useful in that form.
</p>

<div class="org-src-container">
<pre class="src src-bqn">10 MP 1500‿2000‿44556‿55663330000
</pre>
</div>

<pre class="example">
⟨ "055663378056" "07440405994440000000000" ⟩
</pre>
</div>
</div>
<div id="outline-container-org0ffacf0" class="outline-2">
<h2 id="org0ffacf0">Problem 17</h2>
<div class="outline-text-2" id="text-org0ffacf0">
<p>
Nothing special here, store the lengths of the ones', teens' and tens' names
(with padding), pass it in a modifier because a variable would be ugly,
and pattern match:
</p>

<div class="org-src-container">
<pre class="src src-bqn">E17 ← (|⋈˜·⌊÷˜) {
   𝔽 _𝕣_ 𝕘 1000: 11;
   𝕩&lt;100 ? (⊑10‿20⊸&gt;⊐1˙)◶⟨0⊸⋈⊑𝔾, 𝕘⊑˜1⋈-⟜10, +´·⊑⟜𝕘2‿0⋈¨10⊸𝔽⟩𝕩;
   (7+0⊸⋈⊑𝔾)⊸+⟜(××3+𝕊)´100𝔽𝕩
} [0‿3‿3‿5‿4‿4‿3‿5‿5‿4, 3‿6‿6‿8‿8‿7‿7‿9‿8‿8, 0‿0‿6‿6‿5‿5‿5‿7‿6‿6]
</pre>
</div>

<p>
The magic numbers 11, 7, and 3 are for <code>one thousand</code>, <code>hundred</code> and <code>and</code> respectively.
</p>
</div>
</div>
<div id="outline-container-org65aebf7" class="outline-2">
<h2 id="org65aebf7">Problems 18 and 67</h2>
<div class="outline-text-2" id="text-org65aebf7">
<p>
First we do some parsing, the lame padding to make it look like a proper low triangular
matrix:
</p>

<div class="org-src-container">
<pre class="src src-bqn">inp18 ← &gt;(⊢↑¨˜·≠⊢´)•ParseFloat⚇1' '⊸parsing.Split¨•FLines "../../supp/pe/18.inp"
</pre>
</div>

<pre class="example" id="orgcf053ac">
┌─                                              
╵ 75  0  0  0  0  0  0  0  0  0  0  0  0  0  0  
  95 64  0  0  0  0  0  0  0  0  0  0  0  0  0  
  17 47 82  0  0  0  0  0  0  0  0  0  0  0  0  
  18 35 87 10  0  0  0  0  0  0  0  0  0  0  0  
  20  4 82 47 65  0  0  0  0  0  0  0  0  0  0  
  19  1 23 75  3 34  0  0  0  0  0  0  0  0  0  
  88  2 77 73  7 63 67  0  0  0  0  0  0  0  0  
  99 65  4 28  6 16 70 92  0  0  0  0  0  0  0  
  41 41 26 56 83 40 80 70 33  0  0  0  0  0  0  
  41 48 72 33 47 32 37 16 94 29  0  0  0  0  0  
  53 71 44 65 25 43 91 52 97 51 14  0  0  0  0  
  70 11 33 28 77 73 17 78 39 68 17 57  0  0  0  
  91 71 52 38 17 14 91 43 58 50 27 29 48  0  0  
  63 66  4 68 89 53 67 30 73 16 69 87 40 31  0  
   4 62 98 27 23  9 70 98 73 93 38 53 60  4 23  
                                               ┘
</pre>

<p>
Then, what a beautiful array dynamic programming solution!
</p>

<div class="org-src-container">
<pre class="src src-bqn">E18 ← ⊑+⟜(⌈⟜«)˝
</pre>
</div>

<p>
This solution also works for Problem 67, which has only larger input. You get the answer in microseconds.
</p>
</div>
</div>
<div id="outline-container-orgae05ab7" class="outline-2">
<h2 id="orgae05ab7">Problem 19</h2>
<div class="outline-text-2" id="text-orgae05ab7">
<p>
Here we simply simulate the Gregorian calendar, and since in the desired range we don't
have to account for <a href="https://en.wikipedia.org/wiki/Century_leap_year">century leap years</a>, testing multiples of 4 suffices:
</p>

<div class="org-src-container">
<pre class="src src-bqn">E19 ← {
  m ← 31‿28‿31‿30‿31‿30‿31‿31‿30‿31‿30‿31
  {+´0=7|2+`⥊𝕩⊸+⌾(1⊏⍉)m˘𝕩}0=4|↓⟜↕○(1⊸+)´𝕩
}
</pre>
</div>

<p>
Don't forget to add the proper initial to the scan, <code>7|1+365</code>.
</p>
</div>
</div>
<div id="outline-container-orge4e8208" class="outline-2">
<h2 id="orge4e8208">Problem 20</h2>
<div class="outline-text-2" id="text-orge4e8208">
<p>
Here we can use the same method for bigint arithmetic of <a href="#pe16">Problem 16</a>. We define the array
that will contain the digits, using an upper bound. This array will be used as the initial for
the fold of the product over the numbers in <code>1+↕100</code>. That's it.
</p>

<div class="org-src-container">
<pre class="src src-bqn">inp20 ← 1∾0⥊˜1+⌊+´10⋆⁼1+↕100
</pre>
</div>

<p>
Then we reuse the tacit function for arbitrary precision multiplication:
</p>

<div class="org-src-container">
<pre class="src src-bqn">E20 ← 10{𝕗⊸(|+⟜»·⌊÷˜)⍟(⌈𝕗⋆⁼100×𝕗-1)}∘×´
</pre>
</div>

<p>
Note that here we implement the high school multiplication algorithm, for larger <code>n</code>
we need to use Karatsuba's algorithm or the FFT-based convolution. The base would
have to be adjusted as well.
</p>
</div>
</div>
<div id="outline-container-org30d3cd9" class="outline-2">
<h2 id="org30d3cd9">Problem 21</h2>
<div class="outline-text-2" id="text-org30d3cd9">
<div class="org-src-container">
<pre class="src src-bqn">≠{(𝕩⊸&gt;∧n⊸≠)⊸/utils.Sigma¨n←2↓↕𝕩}1e4
</pre>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
If I make it that far, I will follow the rule of not sharing solutions
to problems over 100. In that case, I will probably encrypt them with <code>org-crypt</code>,
using the value of the solution as the key.
</p>

<div style="text-align: center; font-size: 2em; padding: 20px 0;">
  <a href="https://panadestein.github.io/blog/" style="text-decoration: none;">⊑∘∞</a>
</div></div></div>


</div>
</div></div>
</body>
</html>
