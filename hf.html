<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Helonium's Hartree-Fock program</title>
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="assets/style.css"/>
<link rel="icon" href="assets/favicon.ico" type="image/x-icon">
<style>
mjx-container[jax="CHTML"] {
overflow-x: auto !important;
}
</style>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Helonium's Hartree-Fock program</h1>
<div id="outline-container-org11b79b0" class="outline-2">
<h2 id="org11b79b0">Exordium</h2>
<div class="outline-text-2" id="text-org11b79b0">
<p>
We will implement the Hartree-Fock<sup><a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup> program from the classic <a href="https://store.doverpublications.com/products/9780486691862">Szabo-Ostlund</a> text,
a staple in quantum chemistry. If you have any experience in the field, chances are you know it well.
If you don't, the BQN implementation will take you only a few cognitive units: the coarse mathematical
description involves basis sets, the calculation of electronic integrals, and the self-consistent
optimization of the Fock matrix. Using this program, we will compute the energy of the HeH\(^+\) molecule<sup><a id="fnr.2" class="footref" href="#fn.2" role="doc-backlink">2</a></sup>.
</p>

<p>
First, we import the required BQN system values and utility functions:
</p>

<div class="org-src-container">
<pre class="src src-bqn">Sinâ€¿Cosâ€¿ATanâ€¿Erf â† â€¢math
Setplotâ€¿Plot â† â€¢Import "../bqn-utils/plots.bqn"
</pre>
</div>

<p>
Some auxiliary functions are needed for the computation of the Boys function, the matrix and vector product,
the spectrum of a matrix with shape 2â€¿2, and LÃ¶wdin's canonical orthogonalization. Additionally, we define
a 1-modifier to compute the fixed point of a function:
</p>

<div class="org-src-container">
<pre class="src src-bqn">E â† 1eÂ¯6âŠ¸&lt;â—¶(1-Ã·âŸœ3)â€¿((Ï€Ã·4)âŠ¸Ã·Ã—âŸœErfâ—‹âˆšâŠ¢)
P â† +Ëâˆ˜Ã—â‰1â€¿âˆ
D â† (âŠ¢â‹ˆÂ·PÂ´&lt;âˆ˜âŠ¢âˆ¾â‹ˆ)âŸœ([Cosâ€¿Sinâ‹„Sinâ€¿(-Cos)]{ğ•ğ•©}Â¨Â·&lt;2Ã·ËœÂ·ATan 2Ã—0â€¿1âŠ¸âŠ‘Ã·Â·-Â´0â€¿0âŠ¸â‰)
L â† (-âŒ¾(1â€¿1âŠ¸âŠ‘)Â·Ã·âˆ˜âˆšâ‰¢â¥Š2Ë™)âŠ¸P(0Â¨âŒ¾(0â€¿0â‰âŒ½Ë˜)Â·Ã·âˆ˜âˆš1+1â€¿Â¯1Ã—âŒ½Ë˜)
_fp â† {ğ•Šâˆ˜âŠ¢âŸâ‰¢âŸœğ”½ğ•©}
</pre>
</div>

<p>
Then, we create a namespace with the physical constants defining the system<sup><a id="fnr.3" class="footref" href="#fn.3" role="doc-backlink">3</a></sup>,
as is customary in <i>ab-initio</i> methods:
</p>

<div class="org-src-container">
<pre class="src src-bqn">system â† {
  e1â€¿e2 â‡ 2.0925â€¿1.24
  z1â€¿z2 â‡ 2â€¿1
  r â‡ 1.4632 
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org2d229c4" class="outline-2">
<h2 id="org2d229c4">Basis set</h2>
<div class="outline-text-2" id="text-org2d229c4">
<p>
Basis sets are used to transform the PDEs into linear algebra problems. Physical intuition suggests that
Slater type orbitals<sup><a id="fnr.4" class="footref" href="#fn.4" role="doc-backlink">4</a></sup> are a good choice for our Hamiltonian. However, the computation of the integrals
is a lot easier if we approximate them using Gaussian functions<sup><a id="fnr.5" class="footref" href="#fn.5" role="doc-backlink">5</a></sup>. Specifically, the STO-3G approach defines
the approximating function as follows:
</p>

<div class="org-src-container">
<pre class="src src-bqn">STO â† {
  e â† 0.109818â€¿0.405771â€¿2.22766 Ã—Ã—Ëœ ğ•©
  c â† 0.444635â€¿0.535328â€¿0.154329
  eâ‹ˆcÃ—(2Ã—eÃ·Ï€)â‹†3Ã·4
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcd0b32e" class="outline-2">
<h2 id="orgcd0b32e">Electronic integrals</h2>
<div class="outline-text-2" id="text-orgcd0b32e">
<p>
Constructing the integrals' tensor is complicated<sup><a id="fnr.6" class="footref" href="#fn.6" role="doc-backlink">6</a></sup> and is the main reason for the poor scaling
of electronic structure methods. The \(1s\) orbitals are the simplest case, and here two types of integrals
are analytical (S, T) while the rest already lacks a closed-form solution (V, ERI):
</p>

<div class="org-src-container">
<pre class="src src-bqn">S â† {aâ€¿bğ•Šğ•©: (1.5â‹†ËœÏ€Ã·a+b) Ã— â‹†-ğ•©Ã—a(Ã—Ã·+)b}
T â† {aâ€¿bğ•Šğ•©: f â† a(Ã—Ã·+)b â‹„ Ã—Â´âŸ¨1.5â‹†ËœÏ€Ã·a+b, (3Ã—f)-2Ã—ğ•©Ã—Ã—Ëœf, â‹†-ğ•©Ã—fâŸ©}
V â† {aâ€¿bâ€¿zğ•Šrâ€¿s: Ã—Â´âŸ¨-2Ã—zÃ—Ï€Ã·a+b, E sÃ—a+b, â‹†-rÃ—a(Ã—Ã·+)bâŸ©}
ERI â† {aâ€¿bâ€¿câ€¿dğ•Šr1â€¿r2â€¿r3â€¿r4:
  r5 â† -Â´âŸ¨aâ€¿b â‹„ câ€¿dâŸ© (+Â´âˆ˜Ã—Ã·+Â´âˆ˜âŠ£)Â¨ âŸ¨r1â€¿r2 â‹„ r3â€¿r4âŸ©
  f1â€¿f2â€¿f3 â† aâ€¿b ({(âˆšâˆ˜+Ã—Ã—)â‹ˆ(Ã—Ã·+)}â—‹(+Â´)âˆ¾&lt;âˆ˜â‹ˆâ—‹((Ã—Ã·+)Â´)) câ€¿d
  Ã—Â´âŸ¨f1Ã·Ëœ2Ã—Ï€â‹†5Ã·2, E f2Ã—Ã—Ëœr5, â‹†-+Â´f3Ã—Ã—Ëœ-Â´Â¨âŸ¨r1â€¿r2, r3â€¿r4âŸ©âŸ©
}
</pre>
</div>

<br/>
<details>
<summary>Derivation strategy</summary>

<p>
We need to compute the overlap (S), kinetic energy (T), nuclear attraction (V), and four-center (ERI) integrals.
Crucially, the product of two Gaussians at different centers is proportional to a Gaussian at a scaled center.
This property, combined with the Laplacian of a Gaussian, readily yields S and T. The remaining
two sets are more complex: we combine the Gaussians as before, then transform to reciprocal space where
the delta distribution arises and simplifies the problem to this integration by reduction:
</p>

\begin{equation*}
  I(x) = \int_0^{\infty}{{{e^ {- a\,k^2 }\,\sin \left(k\,x\right)}\over{k}}\;dk} \sim \text{Erf}(x)
\end{equation*}

</details>

<p>
The following namespace exports the corresponding integral arrays. Extending the code to an arbitrary number
of atoms implies mapping over an array of coordinates, as opposed to fusing them in the implementation.
</p>

<div class="org-src-container">
<pre class="src src-bqn">I â† {ğ•Še1â€¿e2â€¿z1â€¿z2â€¿r:
  bsâ€¿naâ€¿nb â† (&lt;âˆ¾Â·â‰¢âŠâˆ˜&gt;)â‰&gt;STOÂ¨ e1â€¿e2
  M â† {âˆ¾â€¿Ã—({2: {nb(â‹ˆËœ/âˆ˜â‹ˆËœ)âŠ¸âŠ”ğ•âŒœËœğ•©}; 4: {ğ•âŒœâŸ3Ëœğ•©}}ğ•©)Â¨â—‹âŠ¢&lt;âˆ˜âˆ¾Ë˜bs}

  smâ€¿hcore â‡ {eğ•Šc:
    mst â† âŒ½âŠ¸â‰âˆ¾âŸœ0Ã—Ëœr
    r1â€¿r2 â† &lt;Ë˜â‰â¼&gt; (râŠ¸-âŠ¸â‹ˆËœÃ—âŸœrÃ·+)âŒœÂ´ âŠbs
    mv â† Ã—Ëœâˆ˜{[0â€¿2,3â€¿1]âŠ({0â€¿ğ•¨Â¨ğ•©}âŸœğ•©Â¨ğ•¨)âˆ¾â‹ˆâŸœâ‰râ‹ˆÂ¨ğ•©}Â´Â¨âŸ¨0â€¿r, r1âŸ©â€¿âŸ¨râ€¿0, r2âŸ©
    (âŠ‘â‹ˆÂ·+Â´1âŠ¸â†“)+Â´âˆ˜â¥ŠÂ¨Â¨ c&lt;âŠ¸Ã— ({eğ•Â¨Â¨mst}Â¨Sâ€¿T) âˆ¾ z1â€¿z2{eâˆ¾âŸœğ•¨âŠ¸VÂ¨Â¨ğ•©}Â¨mv
  }Â´ M 2

  erim â‡ {eğ•Šc:
    meri â† (câŠ¸Ã—âŠ£ERIÂ¨âŠ¢/ËœÂ·&lt;Â¨â‰¢âˆ˜âŠ£Ã·â‰¢âˆ˜âŠ¢)âŸœ{0â€¿râŠËœâš‡1â†•naÂ¨â†•=ğ•©} e
    =âŠ¸{+Ëâˆ˜â¥Šâ‰ğ•¨ (2Ã—â†•ğ•¨)â‰â¼(naâ€¿nbâ¥ŠËœnaÃ—ğ•¨)â¥Šğ•©} meri
  }Â´ M 4
}
</pre>
</div>

<br/>
<details>
<summary>Performance</summary>

<p>
The computation of the ERIs is expected to be the primary bottleneck, as there are <code>Nâ‹†4</code> of themâ€”in our case, 16.
The required tensors have a shape of <code>6Â¨â†•4</code>. As shown in the profile below, using an array-based strategy
for the ERIs significantly improved their computational efficiency compared to the two-center integrals.
For the latter, I increased the depth by grouping the tables (block matrices). The resulting code was significantly
slower than replicating the elements to match each axis' length, like I do for the ERIs.
</p>

<div class="org-src-container">
<pre class="src src-bqn">)profile {ğ•Š: I system}Â¨â†•1e4
</pre>
</div>

<pre class="example" id="org54b135e">
Got 37203 samples
(self-hosted runtime1): 1092 samples
(REPL): 36111 samples:
    61â”‚I â† {ğ•Še1â€¿e2â€¿z1â€¿z2â€¿r:
    76â”‚  bsâ€¿naâ€¿nb â† (&lt;âˆ¾Â·â‰¢âŠâˆ˜&gt;)â‰&gt;STOÂ¨ e1â€¿e2
  1942â”‚  M â† {âˆ¾â€¿Ã—({2: {nb(â‹ˆËœ/âˆ˜â‹ˆËœ)âŠ¸âŠ”ğ•âŒœËœğ•©}; 4: {ğ•âŒœâŸ3Ëœğ•©}}ğ•©)Â¨â—‹âŠ¢&lt;âˆ˜âˆ¾Ë˜bs}
      â”‚
   246â”‚  smâ€¿hcore â‡ {eğ•Šc:
   116â”‚    mst â† âŒ½âŠ¸â‰âˆ¾âŸœ0Ã—Ëœr
  4165â”‚    r1â€¿r2 â† &lt;Ë˜â‰â¼&gt; (râŠ¸-âŠ¸â‹ˆËœÃ—âŸœrÃ·+)âŒœÂ´ âŠbs
 15487â”‚    mv â† Ã—Ëœâˆ˜{[0â€¿2,3â€¿1]âŠ({0â€¿ğ•¨Â¨ğ•©}âŸœğ•©Â¨ğ•¨)âˆ¾â‹ˆâŸœâ‰râ‹ˆÂ¨ğ•©}Â´Â¨âŸ¨0â€¿r, r1âŸ©â€¿âŸ¨râ€¿0, r2âŸ©
  8728â”‚    (âŠ‘â‹ˆÂ·+Â´1âŠ¸â†“)+Â´âˆ˜â¥ŠÂ¨Â¨ c&lt;âŠ¸Ã— ({eğ•Â¨Â¨mst}Â¨Sâ€¿T) âˆ¾ z1â€¿z2{eâˆ¾âŸœğ•¨âŠ¸VÂ¨Â¨ğ•©}Â¨mv
  3780â”‚  }Â´ M 2
      â”‚
    10â”‚  erim â‡ {eğ•Šc:
  1193â”‚    meri â† (câŠ¸Ã—âŠ£ERIÂ¨âŠ¢/ËœÂ·&lt;Â¨â‰¢âˆ˜âŠ£Ã·â‰¢âˆ˜âŠ¢)âŸœ{0â€¿râŠËœâš‡1â†•naÂ¨â†•=ğ•©} e
   305â”‚    =âŠ¸{+Ëâˆ˜â¥Šâ‰ğ•¨ (2Ã—â†•ğ•¨)â‰â¼(naâ€¿nbâ¥ŠËœnaÃ—ğ•¨)â¥Šğ•©} meri
     2â”‚  }Â´ M 4
      â”‚}
</pre>

<p>
Morals: Never underestimate the power of vectorization and reshaping operations are often computationally trivial.
</p>

</details>
</div>
</div>
<div id="outline-container-orgf2e90bf" class="outline-2">
<h2 id="orgf2e90bf">Fock matrix</h2>
<div class="outline-text-2" id="text-orgf2e90bf">
<p>
The following function constructs the Fock matrix, our approximation to the true Hamiltonian of the system:
</p>

<div class="org-src-container">
<pre class="src src-bqn">F â† {ğ•©.hcore + ğ•¨ (+Ëâˆ˜â¥Šâ‰2âŠ£Ã—â‰2âŠ¢-2Ã·Ëœ0â€¿3â€¿2âŠ¸â‰â¼) ğ•©.erim}
</pre>
</div>

<br/>
<details>
<summary>Physical context</summary>

<p>
The Fock operator is an effective one-electron operator that arises after constrained
minimization of the energy functional. The form of the functional is a consequence of
the use of <a href="https://en.wikipedia.org/wiki/Slater_determinant">Slater determinants</a> as wave functions.
</p>

\begin{equation*}
  \tilde{\mathcal{F}} \left[ \{\psi_i\} \right] = \sum_i h_i +
  \frac{1}{2} \sum_{i,j} (J_{ij} - K_{ij}) - \sum_{i,j} \lambda_{ij}
  \left( \langle \psi_i | \psi_j \rangle - \delta_{ij} \right)
\end{equation*}

<p>
where \(h_i\) is the core Hamiltonian matrix, \(J_{ij}, K_{ij}\) are the Coulomb and
exchange components of the ERI matrix, and \(\lambda_{ij}\) are Lagrange multipliers.
To fully understand the derivation, consider the variational derivative of this
functional with respect to the complex conjugate of the one-particle wave function \(\psi_i^*\):
</p>

\begin{align*}
  \lim_{\epsilon \to 0} \frac{\tilde{\mathcal{F}} \left[ \psi_k^* + \epsilon \delta
   \psi_k^* \right] - \tilde{\mathcal{F}} \left[ \psi_k^* \right]}{\epsilon} 
  &= \langle \delta \psi_k | \hat{h} | \psi_k \rangle + \sum_j \left( \langle \delta
   \psi_k \psi_j | \frac{1}{r} | \psi_k \psi_j \rangle - \langle \delta
   \psi_k \psi_j | \frac{1}{r} | \psi_j \psi_k \rangle \right)
   - \sum_j \lambda_{kj} \langle \delta \psi_k | \psi_j \rangle \\
  &= \int \left[ \hat{h} \psi_k(x) + \sum_j
     \left( \psi_k(x) \int \frac{|\psi_j(x')|^2}{|r - r'|} dx'
   - \psi_j(x) \int \frac{\psi_j^*(x') \psi_k(x')}{|r - r'|} dx' \right) \right.
   \left. - \sum_j \lambda_{kj} \psi_j(x) \right] \delta \psi_k^*(x) \, dx.
\end{align*}

<p>
As discussed earlier, basis sets are used to discretize the Hartree-Fock problem.
This process results in the  <a href="https://en.wikipedia.org/wiki/Roothaan_equations">Roothaan equations</a>, which are implemented in the code below.
</p>

</details>
</div>
</div>
<div id="outline-container-orgb38b975" class="outline-2">
<h2 id="orgb38b975">Self-consistent field</h2>
<div class="outline-text-2" id="text-orgb38b975">
<p>
The final stage of the computation involves solving the pseudo-eigenvalue problem using a fixed-point iteration.
This process is commonly known as the self-consistent field method, a term coined by D. R. Hartree.
</p>

<div class="org-src-container">
<pre class="src src-bqn">SCF â† {
  ints â† Iğ•©
  pm â† {2Ã—Ã—âŒœËœâŠâ‰ xm(âŠ¢PâŸœâŠ‘Â·DÂ·PÂ´â‰âˆ˜âŠ¢&lt;âŠ¸âˆ¾â‹ˆ)Ëœğ•©F ints}_fp 0Â¨xm â† L ints.sm
  2Ã·Ëœ+Â´âˆ˜â¥Š pm (âŠ£â‰âŠ¸Ã—{ğ•©.hcore + ğ•¨Fğ•©}) ints
}
</pre>
</div>

<p>
If you are receptive and humble, mathematics will lead you by the hand<sup><a id="fnr.7" class="footref" href="#fn.7" role="doc-backlink">7</a></sup>:
</p>

<div class="org-src-container">
<pre class="src src-bqn">SCF system
</pre>
</div>

<pre class="example">
Â¯4.22752930421725
</pre>


<p>
Compare the electronic energy with the one computed using the original <a href="./supp/hf_so/hf_so.html">F66</a> program.
</p>

<details>
<summary>Potential Energy Surface</summary>

<p>
The system's <a href="https://en.wikipedia.org/wiki/Potential_energy_surface">PES</a> will be presented here. For now, itâ€™s (you guessed it) the classic Lennard-Jones:
</p>

<div class="org-src-container">
<pre class="src src-bqn">)r LJ â† 1+4Ã—(â‹†âŸœ12-â‹†âŸœ6)âˆ˜Ã· â‹„ Setplot "line" â‹„ â€¢OutÂ¨ PlotÂ´ (âŠ¢â‹ˆLJ) â†•âˆ˜âŒˆâŒ¾((1+1eÂ¯2Ã—âŠ¢)â¼)3
</pre>
</div>

<br/>
<div style="display: flex; justify-content: center; width: 100%;">
<div style="width: 40%;">
<svg viewBox='-10 -10 404 212.931'>
  <g font-family='BQN,monospace' font-size='18px'>
    <rect class='code' style='fill:none;stroke:black' stroke-width='1' rx='5' x='-5' y='-5' width='394' height='202.931'/>
    <path class='code' style='fill:none;stroke:#267CB9' stroke-width='3' d='M0 0L1.93 42.14L3.859 76.783L5.789 105.053L7.719 127.911L9.648 146.173L11.578 160.54L13.508 171.608L15.437 179.886L17.367 185.812L19.296 189.756L21.226 192.039L23.156 192.931L25.085 192.666L27.015 191.442L28.945 189.43L30.874 186.774L32.804 183.598L34.734 180.007L36.663 176.091L38.593 171.925L40.523 167.575L42.452 163.094L44.382 158.53L46.312 153.92L48.241 149.297L50.171 144.687L52.101 140.114L54.03 135.596L55.96 131.148L57.889 126.781L59.819 122.506L61.749 118.33L63.678 114.258L65.608 110.295L67.538 106.444L69.467 102.706L71.397 99.083L73.327 95.574L75.256 92.179L77.186 88.896L79.116 85.725L81.045 82.664L82.975 79.709L84.905 76.86L86.834 74.113L88.764 71.465L90.693 68.914L92.623 66.457L94.553 64.091L96.482 61.814L98.412 59.621L100.342 57.511L102.271 55.481L104.201 53.527L106.131 51.647L108.06 49.838L109.99 48.098L111.92 46.424L113.849 44.814L115.779 43.264L117.709 41.774L119.638 40.34L121.568 38.96L123.497 37.632L125.427 36.355L127.357 35.125L129.286 33.942L131.216 32.804L133.146 31.708L135.075 30.653L137.005 29.637L138.935 28.659L140.864 27.717L142.794 26.81L144.724 25.937L146.653 25.096L148.583 24.285L150.513 23.504L152.442 22.752L154.372 22.026L156.302 21.327L158.231 20.653L160.161 20.004L162.09 19.377L164.02 18.773L165.95 18.19L167.879 17.628L169.809 17.086L171.739 16.563L173.668 16.058L175.598 15.57L177.528 15.1L179.457 14.646L181.387 14.207L183.317 13.783L185.246 13.374L187.176 12.979L189.106 12.597L191.035 12.228L192.965 11.872L194.894 11.527L196.824 11.194L198.754 10.872L200.683 10.561L202.613 10.259L204.543 9.968L206.472 9.686L208.402 9.414L210.332 9.15L212.261 8.895L214.191 8.648L216.121 8.408L218.05 8.177L219.98 7.953L221.91 7.735L223.839 7.525L225.769 7.322L227.698 7.124L229.628 6.933L231.558 6.748L233.487 6.568L235.417 6.394L237.347 6.225L239.276 6.062L241.206 5.903L243.136 5.749L245.065 5.6L246.995 5.455L248.925 5.315L250.854 5.179L252.784 5.047L254.714 4.918L256.643 4.794L258.573 4.673L260.503 4.556L262.432 4.442L264.362 4.331L266.291 4.224L268.221 4.119L270.151 4.018L272.08 3.919L274.01 3.824L275.94 3.731L277.869 3.64L279.799 3.552L281.729 3.467L283.658 3.384L285.588 3.303L287.518 3.225L289.447 3.149L291.377 3.074L293.307 3.002L295.236 2.932L297.166 2.864L299.095 2.797L301.025 2.732L302.955 2.669L304.884 2.608L306.814 2.549L308.744 2.491L310.673 2.434L312.603 2.379L314.533 2.325L316.462 2.273L318.392 2.222L320.322 2.173L322.251 2.125L324.181 2.078L326.111 2.032L328.04 1.987L329.97 1.944L331.899 1.901L333.829 1.86L335.759 1.82L337.688 1.78L339.618 1.742L341.548 1.705L343.477 1.669L345.407 1.633L347.337 1.598L349.266 1.565L351.196 1.532L353.126 1.5L355.055 1.468L356.985 1.438L358.915 1.408L360.844 1.379L362.774 1.35L364.704 1.323L366.633 1.295L368.563 1.269L370.492 1.243L372.422 1.218L374.352 1.193L376.281 1.169L378.211 1.146L380.141 1.123L382.07 1.101L384 1.079'/>
  </g>
</svg>
</div>
</div>

</details>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Recasting of the <a href="https://en.wikipedia.org/wiki/Schr%C3%B6dinger_equation#Time-independent_equation">TISE</a> into a set of coupled integro-differential equations. Derived by optimizing
the expectation value of the energy subject to normalization constraints, then discretizing it using a suitable
basis set.
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2" role="doc-backlink">2</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
It may not look like much, but helonium was the very <a href="https://www.scientificamerican.com/article/the-first-molecule-in-the-universe/">first molecule</a> formed in the universe.
</p></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3" role="doc-backlink">3</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
This program can compute the Hartree-Fock energy of any two-electron diatomic molecule.
</p></div></div>

<div class="footdef"><sup><a id="fn.4" class="footnum" href="#fnr.4" role="doc-backlink">4</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
STO: functions of the form \(r^le^{-\zeta r}Y_l^m(\theta, \phi)\). For \(1s\) orbitals the
spherical harmonics integrate out to 1.
</p></div></div>

<div class="footdef"><sup><a id="fn.5" class="footnum" href="#fnr.5" role="doc-backlink">5</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
STO-nG: a non-linear least-squares fit of an STO as a weighted sum of n Gaussians.
</p></div></div>

<div class="footdef"><sup><a id="fn.6" class="footnum" href="#fnr.6" role="doc-backlink">6</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
See for example <a href="https://arxiv.org/abs/2007.12057">arXiv:2007.12057</a>.
</p></div></div>

<div class="footdef"><sup><a id="fn.7" class="footnum" href="#fnr.7" role="doc-backlink">7</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Paul A.M. Dirac, 27 November, 1975
</p>

<div style="text-align: center; font-size: 2em; padding: 20px 0;">
  <a href="https://panadestein.github.io/blog/" style="text-decoration: none;">âŠ‘âˆ˜âˆ</a>
</div></div></div>


</div>
</div></div>
</body>
</html>
