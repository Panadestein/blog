<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>A coding impromptu</title>
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="assets/style.css"/>
<link rel="icon" href="assets/favicon.ico" type="image/x-icon">
<style>
#table-of-contents > h2 { display: none; } /* Hide the default TOC heading */
#table-of-contents > ul { display: block; } /* Ensure TOC content is shown */
</style>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">A coding impromptu</h1>
<p>
This post is a rolling collection of algorithms and computational ideas I like, implemented in BQN:
</p>

<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org5830203">Z algorithm</a></li>
<li><a href="#org6c74e30">Longest increasing sub-sequence</a></li>
<li><a href="#orgceda61e">N-queens problem</a></li>
</ul>
</div>
</div>

<p>
Extrapolating Perlis' remark<sup><a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup>, it's likely that a group of 50 individuals
would devise 35 to 40 distinct solutions to even the simplest problem in BQN. Therefore, I will frequently
juxtapose my implementations with those of seasoned <i>BQNators</i>, acknowledging their contributions
in footnotes.
</p>
<div id="outline-container-org5830203" class="outline-2">
<h2 id="org5830203">Z algorithm</h2>
<div class="outline-text-2" id="text-org5830203">
<p>
This is a very efficient procedure that finds prefix strings in <a href="https://cp-algorithms.com/string/z-function.html">linear time</a>. The imperative
implementation reads:
</p>

<div class="org-src-container">
<pre class="src src-bqn">ZI ‚Üê {ùïäs:
  l‚Äør‚Äøz ‚Üê 0‚öá0 0‚Äø0‚Äøs
  z ‚ä£ {
    v ‚Üê r(‚ä¢1‚ä∏+‚Ä¢_while_{(ùï©+ùï®)&lt;‚â†s ? =¬¥‚ü®ùï©,ùï©+ùï®‚ü©‚äë¬®&lt;s ; 0}&lt;‚ó∂({z‚äëÀúùï©-l}‚åä-+1)‚Äø0)ùï©
    r &lt;‚ó∂@‚Äø{ùïä: l‚Ü©ùï©-v+1 ‚ãÑ r‚Ü©ùï©} ùï©+v-1
    z v‚åæ(ùï©‚ä∏‚äë)‚Ü©
  }¬® ‚Üï‚â†s
}
ZI "abacabadabacaba"
</pre>
</div>

<pre class="example">
‚ü® 15 0 1 0 3 0 1 0 7 0 1 0 3 0 1 ‚ü©
</pre>


<p>
Two algorithmic improvements were proposed<sup><a id="fnr.2" class="footref" href="#fn.2" role="doc-backlink">2</a></sup> for the function above, namely only iterate
over indices where the character found is equal to the first character, and only search
to extend the count if it goes up to the end of r:
</p>

<div class="org-src-container">
<pre class="src src-bqn">ZFun ‚Üê {ùïäs:
  CountEq ‚Üê { 1‚ä∏+‚Ä¢_while_((‚â†ùï®)‚ä∏‚â§‚ó∂‚ü®‚äë‚üúùï®‚â°‚äë‚üúùï©,0‚ü©) 0 }
  l‚Üêr‚Üê0 ‚ãÑ Ulr ‚Üê {(r‚åà‚Ü©ùï®+ùï©)&gt;r ? l‚Ü©ùï® ‚ãÑ ùï©; ùï©}
  SearchEq ‚Üê ‚ä£ Ulr ‚ä¢ + + CountEq‚óã(‚Üì‚üús) ‚ä¢
  Set ‚Üê {iùïäùï©: ((r-i) (i SearchEq 0‚åà‚ä£)‚çü‚â§ (i-l)‚äëùï©)‚åæ(i‚ä∏‚äë) ùï© }
  (‚åΩ1‚Üì/‚äë‚ä∏=s) Set¬¥Àú ‚ÜëÀú‚â†s
}
</pre>
</div>

<p>
An array version which I find more beautiful, but has quadratic time complexity is:
</p>

<div class="org-src-container">
<pre class="src src-bqn">ZAQ ‚Üê ¬Ø1‚Üì‚Üì(+¬¥¬∑‚àß`‚ä£=‚â†‚ä∏‚Üë)¬®&lt;
ZAQ "abacabadabacaba"
</pre>
</div>

<pre class="example">
‚ü® 15 0 1 0 3 0 1 0 7 0 1 0 3 0 1 ‚ü©
</pre>


<p>
I also came up with a cubic solution, but as we will see it can be made quadratic:
</p>

<div class="org-src-container">
<pre class="src src-bqn">ZAC ‚Üê (+¬¥‚àß`)¬®&lt;=‚Üï‚àò‚â†{¬´‚çüùï®ùï©}‚åú&lt;
ZAC "abacabadabacaba"
</pre>
</div>

<pre class="example">
‚ü® 15 0 1 0 3 0 1 0 7 0 1 0 3 0 1 ‚ü©
</pre>


<p>
Further improvements where proposed by<sup><a id="fnr.2.2" class="footref" href="#fn.2" role="doc-backlink">2</a></sup><sup>, </sup><sup><a id="fnr.3" class="footref" href="#fn.3" role="doc-backlink">3</a></sup>, rendering the above solutions into:
</p>

<div class="org-src-container">
<pre class="src src-bqn">ZAC ‚Üê (+¬¥‚àß`)¬®‚â†‚Üë‚Üì=‚åΩ‚àò‚Üë
ZAC ‚Üê (+¬¥‚àß`)¬®&lt;=¬´‚çü(‚Üï‚àò‚â†)
</pre>
</div>
</div>
</div>
<div id="outline-container-org6c74e30" class="outline-2">
<h2 id="org6c74e30">Longest increasing sub-sequence</h2>
<div class="outline-text-2" id="text-org6c74e30">
<p>
This <a href="https://en.wikipedia.org/wiki/Longest_increasing_subsequence">problem</a> can be solved in \(O(n\log n)\) using dynamic programming. Here is an
imperative implementation which is quadratic, but can be optimized:
</p>

<div class="org-src-container">
<pre class="src src-bqn">LISI ‚Üê {
  k‚Äødp ‚Üê ¬Ø1‚Äø(‚àû¬®ùï©)
  {i ‚Üê ‚àß¬¥‚ó∂(‚äë‚äê‚üú0)‚Äø{ùïä:k+‚Ü©1} dp&lt;ùï© ‚ãÑ dp ùï©‚åæ(i‚ä∏‚äë)‚Ü©}¬® ùï©
  +¬¥‚àû&gt;dp
}
LISI¬® ‚ü®0‚Äø1‚Äø0‚Äø3‚Äø2‚Äø3, 10‚Äø9‚Äø2‚Äø5‚Äø3‚Äø7‚Äø101‚Äø18, 7‚Äø7‚Äø7‚Äø7‚Äø7‚ü©
</pre>
</div>

<pre class="example">
‚ü® 4 4 1 ‚ü©
</pre>


<p>
A more elegant array and tacit solution was crafted by<sup><a id="fnr.2.2" class="footref" href="#fn.2" role="doc-backlink">2</a></sup><sup>, </sup><sup><a id="fnr.3.3" class="footref" href="#fn.3" role="doc-backlink">3</a></sup>:
</p>

<div class="org-src-container">
<pre class="src src-bqn">LISA ‚Üê +¬¥‚àû‚â†‚àû¬®{ùï®‚åæ((‚äëùï©‚çãùï®-1)‚ä∏‚äë)ùï©}¬¥‚åΩ
LISA¬® ‚ü®0‚Äø1‚Äø0‚Äø3‚Äø2‚Äø3, 10‚Äø9‚Äø2‚Äø5‚Äø3‚Äø7‚Äø101‚Äø18, 7‚Äø7‚Äø7‚Äø7‚Äø7‚ü©
</pre>
</div>

<pre class="example">
‚ü® 4 4 1 ‚ü©
</pre>


<p>
In case you are wondering like I did, the minus one there is to make the bins comparison
strictly increasing.
</p>
</div>
</div>
<div id="outline-container-orgceda61e" class="outline-2">
<h2 id="orgceda61e">N-queens problem</h2>
<div class="outline-text-2" id="text-orgceda61e">
<p>
This problem is the archetypal example of backtracking. Initially, I tried to solve it
using a function to place the queens in the full board, hoping that it would lead to a
more array oriented solution:
</p>

<div class="org-src-container">
<pre class="src src-bqn">8 {((‚à®‚åú¬¥0‚ä∏=)‚à®(0=-‚åú¬¥)‚à®0=+‚åú¬¥) ùï©-¬®&lt;‚Üïùï®} 2‚Äø3
</pre>
</div>

<pre class="example" id="org0b85ee0">
‚îå‚îÄ                 
‚ïµ 0 1 0 1 0 1 0 0  
  0 0 1 1 1 0 0 0  
  1 1 1 1 1 1 1 1  
  0 0 1 1 1 0 0 0  
  0 1 0 1 0 1 0 0  
  1 0 0 1 0 0 1 0  
  0 0 0 1 0 0 0 1  
  0 0 0 1 0 0 0 0  
                  ‚îò
</pre>

<p>
This resulted in a more complicated algorithm, so I decided to go for the classical
Wirth implementation:
</p>

<div class="org-src-container">
<pre class="src src-bqn">NQ ‚Üê {ùïän:
  V‚ÄøP ‚Üê {‚ä£ùïè(‚ä¢‚àæ-‚ãà+)¬¥‚àò‚ä¢}¬® ‚ü®‚à®¬¥‚äë¬®Àú, {1‚åæ(ùï©‚ä∏‚äë)ùï®}¬®‚ü©
  {n‚â†ùï© ? +¬¥(ùï®V‚ä¢)‚ó∂‚ü®(ùï©+1)ùïäÀúùï®P‚ä¢,0‚ü©‚àò(ùï©‚ãà‚ä¢)¬® ‚Üïn ; 1
  }Àú¬¥ (0‚ãà0√ó¬∑‚Üï¬®‚ä¢‚àæ¬∑‚ãàÀú+Àú)n 
}
</pre>
</div>

<p>
Which nicely compares with the OEIS <a href="https://oeis.org/A000170">sequence</a>:
</p>

<div class="org-src-container">
<pre class="src src-bqn">a000170 ‚Üê 1‚Äø0‚Äø0‚Äø2‚Äø10‚Äø4‚Äø40‚Äø92
a000170 ‚â° NQ¬® 1+‚Üï8
</pre>
</div>

<pre class="example">
1
</pre>


<p>
And of course, in the implementation above I could have used a single array instead of three,
but I find the resulting validation and position functions very aesthetic the way they are.
</p>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Almost Perfect Artifacts Improve only in Small Ways: APL is more French than English,
Alan J. Perlis (1978). From <a href="https://www.jsoftware.com/papers/perlis78.htm">jsoftware</a>'s papers collection.
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2" role="doc-backlink">2</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://github.com/mlochbaum">Marshall Lochbaum</a>, the BQN creator.
</p></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3" role="doc-backlink">3</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://github.com/dzaima">dzaima</a>, the CBQN developer.
</p>

<div style="text-align: center; font-size: 2em; padding: 20px 0;">
  <a href="https://panadestein.github.io/blog/" style="text-decoration: none;">‚äë‚àò‚àû</a>
</div></div></div>


</div>
</div></div>
</body>
</html>
