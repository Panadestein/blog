Setplot‿Plot ← •Import "../bqn-utils/plots.bqn"
U ← 0.5-˜•rand.Range⟜0
M ← +˝∘×⎉1‿∞
RMS ← √≠∘⊢÷˜·+´×˜∘-

Minn ← {rt‿ly𝕊dat:
  A‿DA ← ⟨1÷1+⋆∘-, ⊢×1⊸-⟩
  BP ← {fs‿ts‿we𝕊𝕩:
    do ← <(-⟜ts×DA)⊑⊑hx‿tx ← ¯1(↑⋈↓)𝕩
    (fs<⊸∾tx)×⌜˜¨do∾˜do⊸({d𝕊w‿z: z DA⊸×d M˜⍉w}`)⌾⌽tx⋈¨˜1↓we
  }
  FP ← {z𝕊b‿we: A¨b+we M z}`⟜(⋈¨´)
  nn ← dat{𝕨𝕊bi‿we: fs‿ts ← 𝕨(↑⋈↓)˜⊑ly
    bi⋈we-rt× fs‿ts‿we BP fs<⊸FP𝕩}˝˜(U⚇1-⟜1∘≠⋈·<∘⌽˘2⊸↕)ly
  E ⇐ ⊢´<⊸FP⟜nn
}

ntd‿npd‿e‿ri‿rf ← 50‿50‿800‿2.8‿4
pd ← ∾{𝕩∾˘⊏⍉2↕𝕩(⊣×1⊸-×⊢)⍟(↕npd)•rand.Range 0}¨↕∘⌈⌾((ri+0.01×⊢)⁼)rf
td ← ∾⍟(e-1)˜∾{𝕩∾˘2↕𝕩(⊣×1⊸-×⊢)⍟(↕ntd)•rand.Range 0}¨↕∘⌈⌾((ri+0.1×⊢)⁼)rf
≠¨td‿pd

lm ← 0.001‿⟨2, 100, 1⟩ Minn td
(⊢RMS⟜∾·lm.E¨⊣)˝⍉td

)r Setplot "scatter" ⋄ •Out¨ Plot˝⍉(⊑∾lm.E)˘pd
