Setplot‿Plot ← •Import "../bqn-utils/plots.bqn"
U ← 0.5-˜•rand.Range⟜0
M ← +˝∘×⎉1‿∞

Minn ← {rt‿ly𝕊dat:
  A‿DA ← ⟨1÷1+⋆∘-, ⊢×1⊸-⟩
  BP ← {fs‿ts‿we𝕊𝕩:
    do ← <(-⟜ts×DA)⊑⊑hx‿tx ← ¯1(↑⋈↓)𝕩
    (fs<⊸∾tx)×⌜˜¨do∾˜do⊸({d𝕊w‿z: z DA⊸×d M˜⍉w}`)⌾⌽tx⋈¨˜1↓we
  }
  FP ← {z𝕊b‿we: A¨b+we M z}`⟜(⋈¨´)
  nn ← dat{𝕨𝕊bi‿we: fs‿ts ← 𝕨(↑⋈↓)˜⊑ly
    bi⋈we-rt× fs‿ts‿we BP fs<⊸FP𝕩}˝˜(U⚇1-⟜1∘≠⋈·<∘⌽˘2⊸↕)ly
  E ⇐ ⊢´<⊸FP⟜nn
}

n‿e‿ri‿rf‿dr ← 200‿300‿2.8‿4‿0.1
pd ← ∾{𝕩∾˘⊏⍉2↕𝕩(⊣×1⊸-×⊢)⍟(↕⌊3÷˜n)•rand.Range 0}¨↕∘⌈⌾((ri+0.01×⊢)⁼)rf
@⊣td ← ∾⍟(e-1)˜∾{𝕩∾˘2↕𝕩(⊣×1⊸-×⊢)⍟(↕n)•rand.Range 0}¨↕∘⌈⌾((ri+dr×⊢)⁼)rf

lm ← 0.001‿⟨2, 300, 1⟩ Minn td

)r Setplot "scatter" ⋄ •Out¨ Plot˝⍉(⊑∾lm.E)˘pd
