#+TITLE: Project Euler solutions
#+PROPERTY: header-args :tangle ../bqn/pe.bqn

** Disclaimer

This file contains my BQN solutions to some of the problems in [[https://projecteuler.net/][Project Euler]].
It is discouraged to share them, but I very much dislike writing throw-away code,
and that's why they are here. I will not blog about it, but I am happy to discuss
them with anyone who is interested.

** Problem 1

#+begin_src bqn
  E1 â† +Â´(âˆ¨Â´0=5â€¿3|<)âŠ¸/
#+end_src

#+RESULTS:
: +Â´(âˆ¨Â´0=âŸ¨ 5 3 âŸ©|<)âŠ¸/

#+begin_src bqn :tangle no
  E1 â†•1e3
#+end_src

#+RESULTS:
: 233168

** Problem 2

Estimate the upper bound with Binet's formula.

#+begin_src bqn
  E2 â† {+Â´(Â¬2âŠ¸|)âŠ¸/{âŠ‘Â¨+`âˆ˜âŒ½âŸ(â†•ğ•©)â†•2}(âŒˆ0.5+ğ•©âŠ¸Ã—Ã·â—‹(â‹†â¼)2Ã·Ëœ1âŠ¸+)âˆš5}
#+end_src

#+RESULTS:
: (function block)

#+begin_src bqn :tangle no
  E2 4e6
#+end_src

#+RESULTS:
: 4613732

** Problem 3

A brute force attempt, in which I got lucky. We create a primes table, and then check:

#+begin_src bqn :tangle no
  p â† Â¬âˆ˜âˆŠâŸœ(â¥ŠÃ—âŒœËœ)âŠ¸/2â†“â†•1e4
  {ğ•©=Ã—Â´fâ†p/Ëœ0=p|<ğ•© ? âŒˆÂ´f; @}600851475143
#+end_src

#+RESULTS:
: 6857

Provided the size of the input, a much reasonable approach is trial division. We can
achieve this with the following tacit function:

#+begin_src bqn
  E3 â† âŠ¢Â´(0=|)â—¶âŸ¨+âŸœ2âŠ¸â‹ˆ, âŠ£â‹ˆÃ·ËœâŸ©Â´â€¢_while_(Ã—Ëœâˆ˜âŠ£âŠ¸<Â´)
#+end_src

#+RESULTS:
: âŠ¢Â´(0=|)â—¶âŸ¨ +âŸœ2âŠ¸â‹ˆ âŠ£â‹ˆÃ·Ëœ âŸ©Â´â€¢_while_(Ã—Ëœâˆ˜âŠ£âŠ¸<Â´)

#+begin_src bqn :tangle no
  E3 3â€¿600851475143 
#+end_src

#+RESULTS:
: 6857

Explanation: since the number is odd, we can start with 3. While the current
divisor is less than the square root of the current number, we check if it
divides the number. If it does, we divide the number by the divisor.
If it doesn't, we increment the divisor by 2 (to consider only odd factors).
This works because a composite number must have a prime factor less
than or equal to its square root.

** Problem 4

Anything other than brute force here? A little tacit function:

#+begin_src bqn
  E4 â† âŒˆÂ´Â·(âŒ½âŠ¸â‰¡â€¢Fmt)Â¨âŠ¸/Â·â¥ŠÃ—âŒœËœ
#+end_src

#+RESULTS:
: âŒˆÂ´((âŒ½âŠ¸â‰¡â€¢Fmt)Â¨âŠ¸/(â¥ŠÃ—âŒœËœ))

#+begin_src bqn :tangle no
  E4 900+â†•101
#+end_src

#+RESULTS:
: 906609

This runs in 5 ms with the optimization of searching only in the 900's.

** Problem 5

That felt almost trivial.

#+begin_src bqn
  E5 â† â€¢math.LCMÂ´
#+end_src

#+RESULTS:
: â€¢math.LCMÂ´

#+begin_src bqn :tangle no
  E5 1+â†•20
#+end_src

#+RESULTS:
: 232792560

** Problem 6

Yeah well, what can I say, I love this identity:

#+begin_src bqn
  E6 â† Ã—ËœâŠ¸(+Â´Ã—-âŠ£)
#+end_src

#+RESULTS:
: Ã—ËœâŠ¸(+Â´Ã—-âŠ£)

#+begin_src bqn :tangle no
  E6 1+â†•100
#+end_src

#+RESULTS:
: 25164150

In fact, I was terribly stupid. There are closed form solutions for the sum
of the first \(n\) integers and its squares (remember induction?). So after
squaring the former, subtracting the latter and simplifying we get this constant
time solution:

#+begin_src bqn :tangle no
  12Ã·ËœÃ—Â´âŸ¨âŠ¢, -âŸœ1, +âŸœ1, 2+3âŠ¸Ã—âŸ©{ğ•ğ•©}Â¨100
#+end_src

#+RESULTS:
: 25164150

Quite a few characters more, though.


** PE7

The idea here is to use Eratosthenes' sieve with a correct upper bound, which we get
thanks to Rosser's [[https://en.wikipedia.org/wiki/Prime-counting_function#Inequalities][theorem]]:

#+begin_src bqn
  Sieve â† {
    L â† {â†•âˆ˜âŒˆâŒ¾((ğ•¨Ã—ËœâŠ¸+ğ•¨Ã—âŠ¢)â¼)âˆ˜â‰ âŠ¸{0Â¨âŒ¾(ğ•¨âŠ¸âŠ)ğ•©}ğ•©}
    S â† âŠ¢>Ã—Ëœâˆ˜âŠ£âŠ¸â¥ŠâŸœ0Â»â‰ âˆ˜âŠ¢â¥Šâ†‘âŸœ1
    2â†“/(ğ•©â¥Š1)â‰¤âŸœ640â—¶Lâ€¿SâŸâŠ‘Â´âŒ½2â†“â†•âŒˆâˆšğ•©
  }
  E7 â† {
    Rosser â† âŒˆâ‹†â¼{ğ”½âˆ˜ğ”½âŠ¸+âŸœğ”½âŠ¸Ã—}
    (-âŸœ1âŠ‘Sieveâˆ˜Rosser) ğ•©
  }
#+end_src

#+RESULTS:
: (function block)

Which evaluates:

#+begin_src bqn :tangle no
  E7 1e4+1
#+end_src

#+RESULTS:
: 104743

The sieve uses heuristics to decide which operation to perform when marking the multiples,
either zeroing the indices for large argument or creating a mask and multiplying by the
current array in the fold. As a bonus, here is a comparison of Eratosthenes' sieves implementations:

#+begin_src bqn :tangle no
  S0 â† 2âŠ¸â†“{ğ”½/(ğ•©â¥Š1)âŠ‘â—¶âŠ¢â€¿{â†•âˆ˜âŒˆâŒ¾((ğ•¨Ã—ËœâŠ¸+ğ•¨Ã—âŠ¢)â¼)âˆ˜â‰ âŠ¸{0Â¨âŒ¾(ğ•¨âŠ¸âŠ)ğ•©}ğ•©}Â´âŒ½ğ”½â†•âŒˆâˆšğ•©}
  S1 â† 2âŠ¸â†“{ğ”½/(ğ•©â¥Š1){â†•âˆ˜âŒˆâŒ¾((ğ•¨Ã—ËœâŠ¸+ğ•¨Ã—âŠ¢)â¼)âˆ˜â‰ âŠ¸{0Â¨âŒ¾(ğ•¨âŠ¸âŠ)ğ•©}ğ•©}âŸâŠ‘Â´âŒ½ğ”½â†•âŒˆâˆšğ•©}
  S2 â† 2âŠ¸â†“{ğ”½/(ğ•©â¥Š1){ğ•©>(â‰ ğ•©)â†‘/â¼â†•âˆ˜âŒˆâŒ¾((ğ•¨Ã—ËœâŠ¸+ğ•¨Ã—âŠ¢)â¼)â‰ ğ•©}âŸâŠ‘Â´âŒ½ğ”½â†•âŒˆâˆšğ•©}
  S3 â† 2âŠ¸â†“{ğ”½/(ğ•©â¥Š1)(âŠ¢>Ã—Ëœâˆ˜âŠ£âŠ¸â¥ŠâŸœ0Â»â‰ âˆ˜âŠ¢â¥Šâ†‘âŸœ1)âŸâŠ‘Â´âŒ½ğ”½â†•âŒˆâˆšğ•©}
  S4 â† {
    L â† {â†•âˆ˜âŒˆâŒ¾((ğ•¨Ã—ËœâŠ¸+ğ•¨Ã—âŠ¢)â¼)âˆ˜â‰ âŠ¸{0Â¨âŒ¾(ğ•¨âŠ¸âŠ)ğ•©}ğ•©}
    S â† âŠ¢>Ã—Ëœâˆ˜âŠ£âŠ¸â¥ŠâŸœ0Â»â‰ âˆ˜âŠ¢â¥Šâ†‘âŸœ1
    2â†“/(ğ•©â¥Š1)â‰¤âŸœ640â—¶Lâ€¿SâŸâŠ‘Â´âŒ½2â†“â†•âŒˆâˆšğ•©
  }
  â€¢Show 1=â‰ âˆ˜â· S0â€¿S1â€¿S2â€¿S3â€¿S4 {ğ•ğ•©}Â¨< 1e4
  S0â€¿S1â€¿S2â€¿S3â€¿S4 {ğ•â€¢_timedğ•¨}âŒœËœ 10â‹†3â€¿5â€¿7â€¿8â€¿9
#+end_src

#+RESULTS:
: 1
: â”Œâ”€                                                                                                      
: â•µ          8.5813eÂ¯5          8.4411eÂ¯5             8.5593eÂ¯5           3.958eÂ¯6 3.6970000000000003eÂ¯6  
:          0.001241902        0.001077388 0.0009073750000000001          7.2879eÂ¯5             7.0424eÂ¯5  
:          0.144439973        0.139676776           0.120608139        0.049470815           0.029924439  
:   3.5437995570000003 2.0786221950000003    3.6722926040000003 3.5986206610000004           0.985192575  
:   28.261043074000003 27.725597807000003     92.62981303100001  98.58912269400001    17.110364360000002  
:                                                                                                        â”˜

** PE8

A simple windowed reduction:

#+begin_src bqn
  E8 â† âŒˆÂ´Â·(Ã—Â´âŠ¢-@+48Ë™)Ë˜13âŠ¸â†•
#+end_src

#+RESULTS:
: âŒˆÂ´((Ã—Â´âŠ¢-@+48Ë™)Ë˜13âŠ¸â†•)

Boom:

#+begin_src bqn :tangle no
  E8 "7316717653133062491922511967442657474235534919493496983520312774506326239578318016984801869478851843858615607891129494954595017379583319528532088055111254069874715852386305071569329096329522744304355766896648950445244523161731856403098711121722383113622298934233803081353362766142828064444866452387493035890729629049156044077239071381051585930796086670172427121883998797908792274921901699720888093776657273330010533678812202354218097512545405947522435258490771167055601360483958644670632441572215539753697817977846174064955149290862569321978468622482839722413756570560574902614079729686524145351004748216637048440319989000889524345065854122758866688116427171479924442928230863465674813919123162824586178664583591245665294765456828489128831426076900422421902267105562632111110937054421750694165896040807198403850962455444362981230987879927244284909188845801561660979191338754992005240636899125607176060588611646710940507754100225698315520005593572972571636269561882670428252483600823257530420752963450"
#+end_src

#+RESULTS:
: 23514624000
